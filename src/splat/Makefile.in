# Makefile.in for splat kernel module

MODULES := splat

DISTFILES = Makefile.in \
            splat-kmem.c splat-random.c splat-taskq.c \
            splat-time.c splat-condvar.c  splat-mutex.c \
            splat-rwlock.c  splat-thread.c splat-ctl.c

# Removed '-std=gnu99' does to compile issues with i386 SPIN_LOCK_UNLOCKED
# EXTRA_CFLAGS += -I$(src)
# EXTRA_CFLAGS += -Wall -Wno-unknown-pragmas -Wno-missing-braces \
#         -Wno-sign-compare -Wno-parentheses -Wno-uninitialized \
#         -Wno-implicit-function-declaration -Wno-unused -Wno-trigraphs \
#         -Wno-char-subscripts -Wno-switch

# Solaris porting layer aggressive tests
obj-m := splat.o

splat-objs += splat-ctl.o
splat-objs += splat-kmem.o
splat-objs += splat-taskq.o
splat-objs += splat-random.o
splat-objs += splat-mutex.o
splat-objs += splat-condvar.o
splat-objs += splat-thread.o
splat-objs += splat-rwlock.o
splat-objs += splat-time.o

splatmodule := splat.ko
splatmoduledir := @kmoduledir@/kernel/lib/

all: all-spec

install: all
	mkdir -p $(DESTDIR)$(splatmoduledir)
	$(INSTALL) -m 644 $(splatmodule) $(DESTDIR)$(splatmoduledir)/$(splatmodule)
	-/sbin/depmod -a

uninstall:
	rm -f $(DESTDIR)$(splatmoduledir)/$(splatmodule)
	-/sbin/depmod -a

clean:
	-rm -f $(splmodule) *.o .*.cmd *.mod.c *.ko *.s */*.o

distclean: clean
	rm -f Makefile
	rm -rf .tmp_versions

maintainer-clean: distclean

distdir: $(DISTFILES)
	cp -p $(DISTFILES) $(distdir)

all-spec:
	$(MAKE) -C @kernelsrc@ SUBDIRS=`pwd` @KERNELMAKE_PARAMS@ modules
